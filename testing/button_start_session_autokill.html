<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Surfly Co-browse</title>
</head>

<body>
	<!-- Text hotlink for starting Surfly -->
	<a href="#" id="startSurfly" onclick="startCobrowsing()">Co-browse</a>

	<script>
    // 1) Insert Surfly widget script asynchronously
    (function(s, u, r, f, l, y) {
      s[f] = s[f] || { init: function() { s[f].q = arguments; } };
      l = u.createElement(r);
      y = u.getElementsByTagName(r)[0];
      l.async = 1;
      l.src = 'https://surfly.com/surfly.js';
      y.parentNode.insertBefore(l, y);
    })(window, document, 'script', 'Surfly');

    // 2) Shared settings for Surfly.init()
    const settings = {
      url: 'https://www.google.com/',
      widget_key: '4e3d97b9f9c549b798eb8735a4b7c619'
    };

    let SurflySessionInstance = null;

    function startCobrowsing() {
      // Initialize Surfly (queues until the widget script loads)
      Surfly.init(settings, function(init) {
        if (!init.success) {
          console.error('Surfly.init failed:', init.errorMsg);
          return;
        }

        // Only create a session if we're not already inside one
        if (!Surfly.isInsideSession) {
          SurflySessionInstance = Surfly.session().create()
            // When Surfly reports that the session window has opened:
            .on('session_started', function(session) {
              console.log('Session window loadedâ€”will end in 5 seconds.');
              // End the session after 5 seconds
              setTimeout(function() {
                session.end();
                console.log('Session ended.');
              }, 5000);
            })
            // Now actually open the session (starts the leader window)
            .startLeader();
        } else {
          console.warn('Already inside a Surfly session.');
        }
      });
    }
  </script>
</body>

</html>